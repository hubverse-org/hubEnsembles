<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute ensemble model outputs by summarizing component model outputs for each combination of model task, output type, and output type id. Supported output types include mean, median, quantile, cdf, and pmf. — simple_ensemble • hubEnsembles</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute ensemble model outputs by summarizing component model outputs for each combination of model task, output type, and output type id. Supported output types include mean, median, quantile, cdf, and pmf. — simple_ensemble"><meta name="description" content="Compute ensemble model outputs by summarizing component model outputs for
each combination of model task, output type, and output type id. Supported
output types include mean, median, quantile, cdf, and pmf."><meta property="og:description" content="Compute ensemble model outputs by summarizing component model outputs for
each combination of model task, output type, and output type id. Supported
output types include mean, median, quantile, cdf, and pmf."><meta property="og:image" content="https://hubverse-org.github.io/hubEnsembles/logo.png"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://hubdocs.readthedocs.io/en/latest/" class="external-link"><img src="https://raw.githubusercontent.com/hubverse-org/hubStyle/main/inst/hubverse.png" id="logo" height="30" alt="hubverse"></a>
    <a class="navbar-brand me-2" href="../index.html">hubEnsembles</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.9.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="nav-link" href="../articles/hubEnsembles.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hubverse-org/hubEnsembles/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute ensemble model outputs by summarizing component model outputs for each combination of model task, output type, and output type id. Supported output types include <code>mean</code>, <code>median</code>, <code>quantile</code>, <code>cdf</code>, and <code>pmf</code>.</h1>
      <small class="dont-index">Source: <a href="https://github.com/hubverse-org/hubEnsembles/blob/main/R/simple_ensemble.R" class="external-link"><code>R/simple_ensemble.R</code></a></small>
      <div class="d-none name"><code>simple_ensemble.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute ensemble model outputs by summarizing component model outputs for
each combination of model task, output type, and output type id. Supported
output types include <code>mean</code>, <code>median</code>, <code>quantile</code>, <code>cdf</code>, and <code>pmf</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simple_ensemble</span><span class="op">(</span></span>
<span>  <span class="va">model_out_tbl</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights_col_name <span class="op">=</span> <span class="st">"weight"</span>,</span>
<span>  agg_fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  agg_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  model_id <span class="op">=</span> <span class="st">"hub-ensemble"</span>,</span>
<span>  task_id_cols <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model-out-tbl">model_out_tbl<a class="anchor" aria-label="anchor" href="#arg-model-out-tbl"></a></dt>
<dd><p>an object of class <code>model_out_tbl</code> with component
model outputs (e.g., predictions).</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>an optional <code>data.frame</code> with component model weights. If
provided, it should have a column named <code>model_id</code> and a column containing
model weights. Optionally, it may contain additional columns corresponding
to task id variables, <code>output_type</code>, or <code>output_type_id</code>, if weights are
specific to values of those variables. The default is <code>NULL</code>, in which case
an equally-weighted ensemble is calculated. Should be prevalidated.</p></dd>


<dt id="arg-weights-col-name">weights_col_name<a class="anchor" aria-label="anchor" href="#arg-weights-col-name"></a></dt>
<dd><p><code>character</code> string naming the column in <code>weights</code>
with model weights. Defaults to <code>"weight"</code></p></dd>


<dt id="arg-agg-fun">agg_fun<a class="anchor" aria-label="anchor" href="#arg-agg-fun"></a></dt>
<dd><p>a function or character string name of a function to use for
aggregating component model outputs into the ensemble outputs. See the
details for more information.</p></dd>


<dt id="arg-agg-args">agg_args<a class="anchor" aria-label="anchor" href="#arg-agg-args"></a></dt>
<dd><p>a named list of any additional arguments that will be passed
to <code>agg_fun</code>.</p></dd>


<dt id="arg-model-id">model_id<a class="anchor" aria-label="anchor" href="#arg-model-id"></a></dt>
<dd><p><code>character</code> string with the identifier to use for the
ensemble model.</p></dd>


<dt id="arg-task-id-cols">task_id_cols<a class="anchor" aria-label="anchor" href="#arg-task-id-cols"></a></dt>
<dd><p><code>character</code> vector with names of columns in
<code>model_out_tbl</code> that specify modeling tasks. Defaults to <code>NULL</code>, in which
case all columns in <code>model_out_tbl</code> other than <code>"model_id"</code>, <code>"output_type"</code>,
<code>"output_type_id"</code>, and <code>"value"</code> are used as task ids.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <code>model_out_tbl</code> object of ensemble predictions. Note that
any additional columns in the input <code>model_out_tbl</code> are dropped.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The default for <code>agg_fun</code> is <code>"mean"</code>, in which case the ensemble's
output is the average of the component model outputs within each group
defined by a combination of values in the task id columns, output type, and
output type id. The provided <code>agg_fun</code> should have an argument <code>x</code> for the
vector of numeric values to summarize, and for weighted methods, an
argument <code>w</code> with a numeric vector of weights. If it desired to use an
aggregation function that does not accept these arguments, a wrapper
would need to be written. For weighted methods, <code>agg_fun = "mean"</code> and
<code>agg_fun = "median"</code> are translated to use <code><a href="https://rdrr.io/pkg/matrixStats/man/weightedMean.html" class="external-link">matrixStats::weightedMean</a></code> and
<code><a href="https://rdrr.io/pkg/matrixStats/man/weightedMedian.html" class="external-link">matrixStats::weightedMedian</a></code> respectively. For <code><a href="https://rdrr.io/pkg/matrixStats/man/weightedMedian.html" class="external-link">matrixStats::weightedMedian</a></code>,
the argument <code>interpolate</code> is automatically set to FALSE to circumvent a
calculation issue that results in invalid distributions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Calculate a weighted median in two ways</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">model_outputs</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>data set ‘model_outputs’ not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fweights</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>data set ‘fweights’ not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">weighted_median1</span> <span class="op">&lt;-</span> <span class="fu">simple_ensemble</span><span class="op">(</span><span class="va">model_outputs</span>, weights <span class="op">=</span> <span class="va">fweights</span>,</span></span>
<span class="r-in"><span>                                    agg_fun <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weighted_median2</span> <span class="op">&lt;-</span> <span class="fu">simple_ensemble</span><span class="op">(</span><span class="va">model_outputs</span>, weights <span class="op">=</span> <span class="va">fweights</span>,</span></span>
<span class="r-in"><span>                                     agg_fun <span class="op">=</span> <span class="fu">matrixStats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/matrixStats/man/weightedMedian.html" class="external-link">weightedMedian</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">weighted_median1</span>, <span class="va">weighted_median2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Evan L Ray, Li Shandross, Emily Howerton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1. PR Previews built by <a href="https://www.netlify.com" class="external-link">Netlify</a>. Provided without <strong>any warranty</strong>.</p>
</div>

    </footer></div>





  </body></html>

